<clickhouse>
    <!--
        Config-Based External Dictionaries

        This file defines dictionaries that load data from PostgreSQL.
        Credentials are stored here (in ClickHouse server config) rather
        than being passed through SQL, which is more secure for production.

        The dictionaries are automatically created when ClickHouse starts.

        Note: Attribute names use PascalCase to match C# entity properties,
        with <expression> elements mapping to the lowercase PostgreSQL columns.
    -->

    <dictionary>
        <name>countries</name>
        <comment>Country reference data from PostgreSQL</comment>

        <source>
            <postgresql>
                <host>postgres</host>
                <port>5432</port>
                <user>postgres</user>
                <password>postgres</password>
                <db>reference_data</db>
                <table>countries</table>
                <invalidate_query>SELECT max(updated_at) FROM countries</invalidate_query>
            </postgresql>
        </source>

        <lifetime>
            <min>60</min>
            <max>300</max>
        </lifetime>

        <layout>
            <hashed />
        </layout>

        <structure>
            <id>
                <name>id</name>
            </id>
            <attribute>
                <name>Name</name>
                <expression>name</expression>
                <type>String</type>
                <null_value>Unknown</null_value>
            </attribute>
            <attribute>
                <name>IsoCode</name>
                <expression>iso_code</expression>
                <type>String</type>
                <null_value>XX</null_value>
            </attribute>
            <attribute>
                <name>Region</name>
                <expression>region</expression>
                <type>String</type>
                <null_value>Unknown</null_value>
            </attribute>
            <attribute>
                <name>Population</name>
                <expression>population</expression>
                <type>UInt64</type>
                <null_value>0</null_value>
            </attribute>
            <attribute>
                <name>IsActive</name>
                <expression>is_active</expression>
                <type>UInt8</type>
                <null_value>0</null_value>
            </attribute>
        </structure>
    </dictionary>

    <dictionary>
        <name>currencies</name>
        <comment>Currency reference data from PostgreSQL (string key)</comment>

        <source>
            <postgresql>
                <host>postgres</host>
                <port>5432</port>
                <user>postgres</user>
                <password>postgres</password>
                <db>reference_data</db>
                <table>currencies</table>
            </postgresql>
        </source>

        <lifetime>
            <min>60</min>
            <max>300</max>
        </lifetime>

        <!-- complex_key_hashed layout for string keys -->
        <layout>
            <complex_key_hashed />
        </layout>

        <structure>
            <key>
                <attribute>
                    <name>Code</name>
                    <expression>code</expression>
                    <type>String</type>
                </attribute>
            </key>
            <attribute>
                <name>Name</name>
                <expression>name</expression>
                <type>String</type>
                <null_value>Unknown Currency</null_value>
            </attribute>
            <attribute>
                <name>Symbol</name>
                <expression>symbol</expression>
                <type>String</type>
                <null_value>?</null_value>
            </attribute>
            <attribute>
                <name>DecimalPlaces</name>
                <expression>decimal_places</expression>
                <type>UInt8</type>
                <null_value>2</null_value>
            </attribute>
        </structure>
    </dictionary>
</clickhouse>
